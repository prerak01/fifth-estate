## Setup Instructions
### Install Project Dependencies
### Compile the Smart Contract
The Compact compiler generates TypeScript bindings and zero-knowledge circuits from the smart contract source code:
### Build the CLI Interface

```bash
sudo docker compose -f proof-server-testnet.yml up -d
sudo docker ps
````

```bash
# Install root dependencies
npm install

# Install ballot-api dependencies
cd ballot-api && npm install && cd ..

# Install contract dependencies and compile
cd contract && npm install && cd..
npm run compact    # Compiles the Compact contract
npm run build      # Copies compiled files to dist/
cd ..

cd ballot-cli
npm install
npm run build
npm run testnet-remote

```



# Ballot DApp

[![Generic badge](https://img.shields.io/badge/Compact%20Compiler-0.23.0-1abc9c.svg)](https://shields.io/)
[![Generic badge](https://img.shields.io/badge/TypeScript-5.8.3-blue.svg)](https://shields.io/)

A Midnight smart contract example demonstrating a simple one-item Ballot with zero-knowledge proofs on testnet. Users can post a single message at a time, and only the message author can remove it.

## Project Structure

```
fifth-estate/
├── contract/               # Smart contract in Compact language
│   └── src/               # Contract source and utilities
├── ballot-api/                   # Methods, classes and types for CLI and UI
├── ballot-cli/            # Command-line interface
│   └── src/               # CLI implementation
└── ballot-ui/             # Web browser interface
    └── src/               # Web UI implementation
```

## Setup Instructions

### Install Project Dependencies

```bash
# Install root dependencies
npm install

# Install ballot-api dependencies
cd ballot-api && npm install && cd ..

# Install contract dependencies and compile
cd contract && npm install
```

### Compile the Smart Contract

The Compact compiler generates TypeScript bindings and zero-knowledge circuits from the smart contract source code:

```bash
# cd contract
npm run compact    # Compiles the Compact contract
npm run build      # Copies compiled files to dist/
cd ..
```

Expected output:

```
> compact
> compact compile src/ballot.compact ./src/managed/ballot

Compiling 2 circuits:
  circuit "post" (k=14, rows=10070)
  circuit "takeDown" (k=14, rows=10087)

> build
> rm -rf dist && tsc --project tsconfig.build.json && cp -Rf ./src/managed ./dist/managed && cp ./src/ballot.compact ./dist

```

### Build the CLI Interface

```bash
cd ballot-cli
npm install
npm run build
cd ..
```

### Build the UI Interface (Optional)

Only needed if you want to use the web interface:

```bash
cd ballot-ui
npm install
npm run build
cd ..
```

## Option 1: CLI Interface

### Start the Proof Server

The proof server must be running before using the CLI to generate zero-knowledge proofs for transactions:

```bash
cd ballot-cli
sudo docker compose -f proof-server-testnet.yml up -d
```

Verify it's running:

```bash
sudo docker ps
```

### Run the CLI

```bash
npm run testnet-remote
```

### Using the CLI

#### Create a Wallet

1. Choose option `1` to build a fresh wallet
2. The system will generate a wallet address and seed
3. **Save both the address and seed** - you'll need them later

Expected output:

```
Your wallet seed is: [64-character hex string]
Your wallet address is: mn_shield-addr_test1...
```

#### Fund Your Wallet

Before deploying contracts, you need testnet tokens.

1. Copy your wallet address from the output above
2. Visit the [testnet faucet](https://midnight.network/test-faucet)
3. Paste your address and request funds
4. Wait for the CLI to detect the funds (takes 2-3 minutes)

Expected output:

```
Your wallet balance is: 1000000000
```

#### Deploy Your Contract

1. Choose the contract deployment option
2. Wait for deployment (takes ~30 seconds)
3. **Save the contract address** for future use

Expected output:

```
Deployed Ballot contract at address: [contract address]
```

#### Use the Ballot

You can now:

- **Post** a message to the Ballot
- **View** the current message
- **Remove** your message (only if you posted it)
- **Exit** when done

Each action creates a real transaction on Midnight Testnet using zero-knowledge proofs generated by the proof server.

## Option 2: Web UI Interface

The web interface uses the same proof server and requires additional browser setup.

### Start the Proof Server (if not already running)

If you haven't started the proof server for the CLI, start it now:

```bash
cd ballot-cli
sudo docker compose -f proof-server-testnet.yml up -d
```

Verify it's running:

```bash
sudo docker ps
```

### Start the Web Interface

```bash
cd ballot-ui
npm run start
```

The UI will be available at:

- http://127.0.0.1:8080

### Browser Setup

1. **Open the UI URL** in a browser with Lace wallet extension installed
2. **Set up Lace wallet** if it's your first time
3. **Authorize the application** when Lace wallet prompts
4. Use the Ballot web interface

## Useful Links

- [Testnet Faucet](https://midnight.network/test-faucet) - Get testnet funds (CLI auto-funds)
- [Midnight Documentation](https://docs.midnight.network/develop/tutorial/building) - Complete developer guide
- [Compact Language Guide](https://docs.midnight.network/develop/reference/compact/writing) - Smart contract language reference
- [Lace Wallet](https://chromewebstore.google.com/detail/lace-midnight-preview/hgeekaiplokcnmakghbdfbgnlfheichg?hl=en) - Browser wallet for Midnight

## Troubleshooting

| Common Issue                       | Solution                                                                                                  |
| ---------------------------------- | --------------------------------------------------------------------------------------------------------- |
| `npm install` fails                | Ensure you're using Node.js LTS version. If you get ERESOLVE errors, try `npm install --legacy-peer-deps` |
| Contract compilation fails         | Ensure you're in `contract` directory and run `npm run compact`                                           |
| Network connection timeout         | CLI requires internet connection, restart if connection times out                                         |
| Token funding takes too long       | Wait 1-2 minutes, funding is automatic in CLI                                                             |
| "Application not authorized" error | Start proof server: `sudo docker compose -f proof-server-testnet.yml up -d`                                    |
| Lace wallet not detected           | Install Lace wallet browser extension and refresh page                                                    |
| sudo docker issues                      | Ensure sudo docker Desktop is running, check `sudo docker --version`                                                |
| Port 6300 in use                   | Run `sudo docker compose down` then restart services                                                           |
| Dependencies won't install         | Use Node.js LTS version. For older npm versions, you may need `--legacy-peer-deps`                        |
| Contract deployment fails          | Verify wallet has sufficient balance and network connection                                               |

## Notes

- CLI and UI can run simultaneously and share the same proof server
- Proof server (sudo docker) is required for both CLI and UI to generate zero-knowledge proofs
- Contract must be compiled before building CLI or UI
- Fund your wallet using the testnet faucet before deploying contracts


## Prerequisites

### 1. Node.js Version Check

You need Node.js (tested with current LTS):

```bash
node --version
```

Expected output: `v22.15.0` or higher.

If you get a lower version: [Install Node.js LTS](https://nodejs.org/).

### 2. sudo docker Installation

The [proof server](https://docs.midnight.network/develop/tutorial/using/proof-server) runs in sudo docker and is required for both CLI and UI to generate zero-knowledge proofs:

```bash
sudo docker --version
```

Expected output: `sudo docker version X.X.X`.

If sudo docker is not found: [Install sudo docker Desktop](https://docs.sudo docker.com/desktop/). Make sure sudo docker Desktop is running.

### 3. Lace Wallet Extension (UI Only)

For the web interface, install [the Lace wallet browser extension](https://chromewebstore.google.com/detail/lace-midnight-preview/hgeekaiplokcnmakghbdfbgnlfheichg?hl=en) from your browser's extension store.
